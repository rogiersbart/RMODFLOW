<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Structure of input data • RMODFLOW</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Structure of input data">
<meta property="og:description" content="RMODFLOW">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RMODFLOW</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/RMODFLOW.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/boundary_conditions.html">Boundary conditions</a>
    </li>
    <li>
      <a href="../articles/input_data_structure.html">Structure of input data</a>
    </li>
    <li>
      <a href="../articles/output.html">Handling MODFLOW output</a>
    </li>
    <li>
      <a href="../articles/parameters.html">MODFLOW parameters</a>
    </li>
    <li>
      <a href="../articles/plotting.html">Plotting in RMODFLOW</a>
    </li>
    <li>
      <a href="../articles/spatial.html">Spatial functions</a>
    </li>
    <li>
      <a href="../articles/top_level.html">Top-level functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rogiersbart/RMODFLOW/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="input_data_structure_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Structure of input data</h1>
                        <h4 class="author">Cas Neyens</h4>
            
            <h4 class="date">2021-10-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rogiersbart/RMODFLOW/blob/master/vignettes/input_data_structure.Rmd"><code>vignettes/input_data_structure.Rmd</code></a></small>
      <div class="hidden name"><code>input_data_structure.Rmd</code></div>

    </div>

    
    
<pre><code>## 
! {RMODFLOW} is still in its experimental lifecycle stage.
## 
! Use at your own risk, and submit issues here:
## 
! &lt;https://github.com/rogiersbart/RMODFLOW/issues&gt;</code></pre>
<p>Input for MODFLOW models is read from user/GUI-generated files. Typically, every package has a separate file and these are accessed and read on a line-by-line basis. The type, number and order of variables being read are strictly predefined for every file and are documented in the MODFLOW user-manual and <a href="https://water.usgs.gov/ogw/modflow/MODFLOW-2005-Guide/index.html?.htm">online help</a>. The MODFLOW source code is almost entirely written in FORTRAN and has evolved over more than three decades. As such, the capabilities of reading input have evolved as well, maintaining backward compatibility. Initially, only fixed-format input could be read, where every value has a predefined amount of characters. In later versions, the less strict free-format could be used. Because of these rigid rules, writing MODFLOW input files by hand can be a cumbersome task. This is one of the reasons to use a GUI or script-based library such as RMODFLOW.</p>
<p>Input for MODFLOW packages can generally be thought of in three forms:</p>
<ol style="list-style-type: decimal">
<li>Scalar values</li>
<li>Array-directed input</li>
<li>List-directed input</li>
</ol>
<div id="scalar-values" class="section level2">
<h2 class="hasAnchor">
<a href="#scalar-values" class="anchor"></a>1. Scalar values</h2>
<p>The first type consists of one or more values on a single line that are read by MODFLOW. These are mostly integers or doubles. For example, the <code>dis</code> file contains the number of rows, columns, layers and stress periods, all as integers. RMODFLOW treats these type of values as scalars. It uses the internal functions <code>rmfi_parse_variables</code> and <code>rmfi_write_variables</code> to read and write these values, respectively. By default, the free-format is used (<code>format = 'free'</code> argument) which simply reads every value on the line. If <code>format = 'fixed'</code>, 10-character fields are read for <code>n</code> values. Missing values are assigned zero. When writing or creating, it is advised to consistently use the free-format (default). If you are having trouble reading in a file and don’t know if free-format is being used, try passing the <code>format = 'fixed'</code> argument to the call of the read function. There are no explicit <code>create</code> functions for scalars; they are simply assigned through arguments in the function calls to the <code>rmf_create_*</code> functions, e.g. <code><a href="../reference/rmf_create_dis.html">rmf_create_dis(nrow = 42, ncol = 42, nlay = 3)</a></code>.</p>
</div>
<div id="array-directed-input" class="section level2">
<h2 class="hasAnchor">
<a href="#array-directed-input" class="anchor"></a>2. Array-directed input</h2>
<p>Array-directed input represents continuous variables over the MODFLOW grid such as the model elevation (<code>dis$top</code>) or hydraulic conductivity (e.g. <code>lpf$hk</code>). MODFLOW output often comes in the form of arrays as well, e.g. simulated heads or drawdowns. In RMODFLOW, MODFLOW arrays are handled by the <code>rmf_array</code> classes and corresponding S3 methods. There are three <code>rmf_array</code> classes: <code>rmf_2d_array</code>, <code>rmf_3d_array</code> and <code>rmf_4d_array</code>. Arrays that are returned from <code>rmf_read_*</code> functions are always of one of these classes. Arrays passed to <code>rmf_write_*</code> functions are also of these classes.</p>
<div id="creating" class="section level3">
<h3 class="hasAnchor">
<a href="#creating" class="anchor"></a>Creating</h3>
<p>To create a <code>rmf_array</code>, use the <code><a href="../reference/rmf_create_array.html">rmf_create_array()</a></code> function. When this function is called on an existing matrix or array, it simply sets the class depending on the dim argument (2D, 3D or 4D). Alternatively, you can supply a dim argument yourself:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">42</span>, nrow <span class="op">=</span> <span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="../reference/rmf_create_array.html">rmf_create_array</a></span><span class="op">(</span><span class="va">ar</span><span class="op">)</span>
<span class="co">#&gt; RMODFLOW 2d array with 4 rows and 5 columns, representing the i &amp; j dimensions. </span>
<span class="co">#&gt; Not representing stress period data </span>
<span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span>
<span class="co">#&gt; [1,]   42   42   42   42   42</span>
<span class="co">#&gt; [2,]   42   42   42   42   42</span>
<span class="co">#&gt; [3,]   42   42   42   42   42</span>
<span class="co">#&gt; [4,]   42   42   42   42   42</span>

<span class="fu"><a href="../reference/rmf_create_array.html">rmf_create_array</a></span><span class="op">(</span><span class="fl">42</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; RMODFLOW 2d array with 4 rows and 5 columns, representing the i &amp; j dimensions. </span>
<span class="co">#&gt; Not representing stress period data </span>
<span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span>
<span class="co">#&gt; [1,]   42   42   42   42   42</span>
<span class="co">#&gt; [2,]   42   42   42   42   42</span>
<span class="co">#&gt; [3,]   42   42   42   42   42</span>
<span class="co">#&gt; [4,]   42   42   42   42   42</span></code></pre></div>
<p>Besides setting the class, <code>rmf_create_array</code> also adds a <code>dimlabel</code> attribute which holds the names of MODFLOW dimensions the array represents. By default, these are <code>i, j, k &amp; l</code> -representing rows, columns, layers and time steps, respectively- for a 4D array, <code>i, j &amp; k</code> for a 3D array and <code>i &amp; j</code> for a 2D array. These can also be set by supplying a dimlabel argument:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rmf_create_array.html">rmf_create_array</a></span><span class="op">(</span><span class="fl">10</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>, dimlabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'rows'</span>, <span class="st">'columns'</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; RMODFLOW 2d array with 2 rows and 5 columns, representing the rows &amp; columns dimensions. </span>
<span class="co">#&gt; Not representing stress period data </span>
<span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span>
<span class="co">#&gt; [1,]   10   10   10   10   10</span>
<span class="co">#&gt; [2,]   10   10   10   10   10</span></code></pre></div>
<p>A <code>rmf_array</code> is <em>at least 2D</em>, possibly 3D or 4D. When creating, it is implicitely assumed that the first dimension of the <code>rmf_array</code> represents rows, the second dimension columns, the optional third dimension layers and the optional fourth dimension time-steps. So if you have a one-layered model, a <code>rmf_4d_array</code> would have a third dimension of length one:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rmf_create_array.html">rmf_create_array</a></span><span class="op">(</span><span class="st">"my_value"</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; RMODFLOW 4d array with 2 rows, 2 columns, 1 layer and 3 timesteps, representing the i, j, k &amp; l dimensions. </span>
<span class="co">#&gt; Not representing stress period data </span>
<span class="co">#&gt; , , 1, 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      [,1]       [,2]      </span>
<span class="co">#&gt; [1,] "my_value" "my_value"</span>
<span class="co">#&gt; [2,] "my_value" "my_value"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , 1, 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      [,1]       [,2]      </span>
<span class="co">#&gt; [1,] "my_value" "my_value"</span>
<span class="co">#&gt; [2,] "my_value" "my_value"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , 1, 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      [,1]       [,2]      </span>
<span class="co">#&gt; [1,] "my_value" "my_value"</span>
<span class="co">#&gt; [2,] "my_value" "my_value"</span></code></pre></div>
<p>A 1D <code>rmf_array</code> does therefore not exist; it is simply an atomic vector. Calling <code>rmf_create_array</code> on an atomic vector returns an error:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rmf_create_array.html">rmf_create_array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error: Please provide 2d matrix, or 2d, 3d or 4d array.</span></code></pre></div>
<p>In base MODFLOW-2005, 1D arrays are only used to assign the DELR and DELC variables (representing widths along rows and columns). It makes little sense to do this in R with verbose calls such as <code><a href="https://rdrr.io/r/base/matrix.html">matrix(100, nrow = 42, ncol = 1)</a></code> or <code><a href="https://rdrr.io/r/base/array.html">array(100, dim = c(42, 1))</a></code> instead of a simple <code><a href="https://rdrr.io/r/base/rep.html">rep(100, 42)</a></code>.</p>
</div>
<div id="subsetting" class="section level3">
<h3 class="hasAnchor">
<a href="#subsetting" class="anchor"></a>Subsetting</h3>
<p>A <code>rmf_array</code> behaves like a common array in R with two exceptions related to subsetting.</p>
<ol style="list-style-type: decimal">
<li>Unlike R arrays, <code>drop = FALSE</code> by default for <code>rmf_arrays</code>. Subsetting a <code>rmf_array</code> will therefore not drop dimensions with length 1 or collapse into the lowest possible dimension unless the result is 1D. This behaviour can be overwritten by setting <code>drop = TRUE</code>.</li>
<li>Unlike R arrays, subsetting a <code>rmf_array</code> will not drop the class. As such, subsetting a <code>rmf_array</code> will always return a <code>rmf_array</code> as long as it has a <code>dim</code> argument, i.e. the subsetted result is 2D, 3D or 4D.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># R array drops dims of length 1</span>
<span class="va">ar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">ar</span><span class="op">[</span>,,,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 2 2</span>

<span class="co"># rmf_array keeps dims of length 1</span>
<span class="va">rmf_ar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmf_create_array.html">rmf_create_array</a></span><span class="op">(</span><span class="va">ar</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">rmf_ar</span><span class="op">[</span>,,,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 2 2 1</span>

<span class="co"># collapses into atomic vector</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">ar</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,,<span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] "numeric"</span>

<span class="co"># remains 4D array since 4th dimension is not subsetted</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">rmf_ar</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,,<span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] "rmf_4d_array"</span>

<span class="co"># collapses</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">rmf_ar</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,,, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] "numeric"</span>

<span class="co"># drops class</span>
<span class="va">ar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="fl">12</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">'not_rmf'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">ar</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] "matrix" "array"</span>

<span class="co"># subsetting a rmf_array always returns a rmf_array...</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">rmf_ar</span><span class="op">)</span>
<span class="co">#&gt; [1] "rmf_4d_array"</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">rmf_ar</span><span class="op">[</span>,,<span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] "rmf_4d_array"</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">rmf_ar</span><span class="op">[</span>,,,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] "rmf_3d_array"</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">rmf_ar</span><span class="op">[</span>,,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] "rmf_2d_array"</span>

<span class="co"># ... unless return is 1D</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">rmf_ar</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] "numeric"</span></code></pre></div>
<p>This creates a consistency when using <code>rmf_arrays</code>. In the example with a one-layered model, classic R arrays would drop the unused 3th dimension. This would result in a 3D array where the third dimension suddenly represents time-steps instead of layers. Furthermore, as long as a subsetted <code>rmf_array</code> remains in fact an array (has a dim argument), it should still be one of the <code>rmf_array</code> classes. For example, extracting a layer from a <code>rmf_3d_array</code> should return a <code>rmf_2d_array</code> instead of becoming a matrix:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extracting a single layer returns a rmf_array</span>
<span class="va">dis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmf_example_file.html">rmf_example_file</a></span><span class="op">(</span><span class="st">"example-model.dis"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/rmf_read_dis.html">rmf_read_dis</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">dis</span><span class="op">$</span><span class="va">botm</span><span class="op">[</span>,,<span class="fl">5</span><span class="op">]</span>
<span class="co">#&gt; RMODFLOW 2d array with 10 rows and 10 columns, representing the i &amp; j dimensions. </span>
<span class="co">#&gt; Not representing stress period data </span>
<span class="co">#&gt;            [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]</span>
<span class="co">#&gt;  [1,] -14.50490 -14.83648 -14.92529 -14.85315 -14.88318 -15.22660 -15.60427</span>
<span class="co">#&gt;  [2,] -14.81713 -14.90889 -14.83753 -14.99092 -15.69238 -16.18429 -16.32294</span>
<span class="co">#&gt;  [3,] -14.96890 -14.85298 -15.06713 -15.79833 -16.28175 -16.32756 -16.73219</span>
<span class="co">#&gt;  [4,] -14.99913 -14.83854 -15.57881 -16.28461 -16.33874 -17.08000 -17.76279</span>
<span class="co">#&gt;  [5,] -14.95689 -15.00021 -16.16134 -16.32473 -17.10558 -17.77778 -16.96283</span>
<span class="co">#&gt;  [6,] -14.84188 -15.63926 -16.31119 -17.02771 -17.78451 -17.00444 -16.31083</span>
<span class="co">#&gt;  [7,] -14.89941 -16.07933 -16.50189 -17.78640 -17.02192 -16.31098 -15.87303</span>
<span class="co">#&gt;  [8,] -14.86487 -15.41835 -16.31006 -16.37534 -16.31068 -15.96870 -14.89909</span>
<span class="co">#&gt;  [9,] -14.90482 -14.86794 -14.92409 -15.38964 -15.45983 -14.93413 -14.91179</span>
<span class="co">#&gt; [10,] -14.61301 -15.13022 -15.15843 -14.96830 -14.88495 -14.88413 -14.86478</span>
<span class="co">#&gt;            [,8]      [,9]     [,10]</span>
<span class="co">#&gt;  [1,] -15.74037 -15.36730 -14.83495</span>
<span class="co">#&gt;  [2,] -16.31697 -16.19521 -14.95860</span>
<span class="co">#&gt;  [3,] -17.61780 -16.32182 -14.97984</span>
<span class="co">#&gt;  [4,] -16.82500 -16.19919 -14.84082</span>
<span class="co">#&gt;  [5,] -16.31050 -15.32750 -14.89233</span>
<span class="co">#&gt;  [6,] -15.77645 -14.83797 -14.88540</span>
<span class="co">#&gt;  [7,] -14.87565 -14.90725 -14.53460</span>
<span class="co">#&gt;  [8,] -14.92088 -14.75577 -14.16998</span>
<span class="co">#&gt;  [9,] -14.89658 -14.34830 -14.10139</span>
<span class="co">#&gt; [10,] -14.41982 -14.11653 -14.18420</span></code></pre></div>
</div>
<div id="time" class="section level3">
<h3 class="hasAnchor">
<a href="#time" class="anchor"></a>Time</h3>
<p>Time in MODFLOW is represented in two ways: through time-steps and stress periods. Time-steps are inherit to the finite-difference equations used by MODFLOW whereas stress periods are used as a convenience for the user. A stress period encompases one or more time-steps during which all temporal input remains constant. Arrays for input files such as recharge arrays can therefore vary per stress period. Output arrays such as simulated heads however, vary on a time-step basis. This creates a design choice for the <code>rmf_array</code>: does the 4th dimension represent time-steps or stress-periods? As stated above, the 4th dimension for a <code>rmf_array</code> represent time-steps since the other dimensions (rows, columns and layers) are also inherited from the finite-difference approximation. If you want a <code>rmf_array</code> to represent constant input over one or more stress periods, you can supply a <code>kper</code> argument to <code>rmf_create_array</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rmf_create_array.html">rmf_create_array</a></span><span class="op">(</span><span class="fl">1.5</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, kper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; RMODFLOW 2d array with 2 rows and 2 columns, representing the i &amp; j dimensions. </span>
<span class="co">#&gt; Active during stress periods: 1 4 </span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]  1.5  1.5</span>
<span class="co">#&gt; [2,]  1.5  1.5</span></code></pre></div>
<p>This sets the <code>kper</code> attribute which is used by the create functions for boundary-conditions to know during which stress-periods this array should be active.</p>
</div>
<div id="reading-writing-rmf_arrays" class="section level3">
<h3 class="hasAnchor">
<a href="#reading-writing-rmf_arrays" class="anchor"></a>Reading &amp; writing rmf_arrays</h3>
<p>In a MODFLOW input file, an array is preceded by a single-line, the array-control record. This line contains information on the type and format of values in the following array and where to read them. There are two types of array-control records:</p>
<ol style="list-style-type: decimal">
<li>Fixed-format</li>
</ol>
<blockquote>
<p>LOCAT CNSTNT FMTIN IPRN</p>
</blockquote>
<ol start="2" style="list-style-type: decimal">
<li>Free-format. This type can take one of four possible forms:</li>
</ol>
<blockquote>
<p><strong>CONSTANT</strong> CNSTNT<br><strong>INTERNAL</strong> CNSTNT FMTIN IPRN<br><strong>EXTERNAL</strong> Nunit CNSTNT FMTIN IPRN<br><strong>OPEN/CLOSE</strong> FNAME CNSTNT FMTIN IPRN</p>
</blockquote>
<p>To add to the complexity, fixed-format and free-format <strong>EXTERNAL</strong> and <strong>OPEN/CLOSE</strong> headers can point to binary files which contain the array. After the array-control records, the array is being read. Each control-record is explained in the manual and <a href="https://water.usgs.gov/ogw/modflow/MODFLOW-2005-Guide/index.html?.htm">online help</a>. RMODFLOW can read fixed-format and all 4 types of free-format array-headers. There is no support for writing fixed-format arrays.</p>
<p>To read MODFLOW arrays, RMODFLOW uses the internal <code>rmfi_parse_array</code> function which is called in all <code>rmf_read_*</code> functions that need to read in arrays. If the array-control record is fixed-format, a <code>nam</code> object (as returned from <code>rmf_read_nam</code>) needs to be supplied in the call to the <code>rmf_read_*</code> function (unless LOCAT = 0). This is because the LOCAT variable represent a FORTRAN unit number which points to the file containing the array. Without the corresponding NAME file, it is impossible to know which file this unit number represents. The same is true when reading <strong>EXTERNAL</strong> files. If the array is binary, the user must know if the array is single or double precision. By default, the <code>precision</code> argument is set to <code>'single'</code>.</p>
<p>Writing arrays to input files is handled by the internal <code>rmfi_write_array</code> function. By default, arrays are written in free-format using either the <strong>CONSTANT</strong> or <strong>INTERNAL</strong> array-control header, depending on whether or not there is more than one unique value in the supplied array. There is support for writing <strong>EXTERNAL</strong> and <strong>OPEN/CLOSE</strong> arrays to external files, but this is discouraged. Keeping all data in a single file creates a more clear and cohesive structure. To write <strong>EXTERNAL</strong> arrays, you will need to supply the <code>external</code> argument to the <code>rmf_write_*</code> call which is a character vector with the names of the data sets to write. It will also need a <code>nam</code> object to check for a unique unit number (Nunit). You will have to add this unit number manually to a NAM file yourself. This is because the <code>rmfi_write_array</code> function is not intended to alter existing RMODFLOW objects; only to write arrays. To write an <strong>OPEN/CLOSE</strong> file, a <code>fname</code> argument needs to be given which is a character vector with the names of the data sets to write. Each OPEN/CLOSE file can contain only one 2D array. Both <strong>EXTERNAL</strong> and <strong>OPEN/CLOSE</strong> files can be written as binary by supplying a <code>binary</code> argument which is a character vector with the names of the data sets to write as binary.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmf_example_file.html">rmf_example_file</a></span><span class="op">(</span><span class="st">"example-model.dis"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/rmf_read_dis.html">rmf_read_dis</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">nam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmf_example_file.html">rmf_example_file</a></span><span class="op">(</span><span class="st">"example-model.nam"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/rmf_read_nam.html">rmf_read_nam</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># this will create separate files for the 3D botm array and for the 2D top array using the EXTERNAL header</span>
<span class="co"># it will also generate a warning as a reminder to add Nunit to the NAME file </span>
<span class="fu"><a href="../reference/rmf_write_dis.html">rmf_write_dis</a></span><span class="op">(</span>dis <span class="op">=</span> <span class="va">dis</span>, file <span class="op">=</span> <span class="st">"input.dis"</span>, external <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"botm"</span>, <span class="st">"top"</span><span class="op">)</span>, nam <span class="op">=</span> <span class="va">nam</span><span class="op">)</span>

<span class="co"># this will create separate binary files for each layer in botm using the OPEN/CLOSE header</span>
<span class="fu"><a href="../reference/rmf_write_dis.html">rmf_write_dis</a></span><span class="op">(</span>dis <span class="op">=</span> <span class="va">dis</span>, file <span class="op">=</span> <span class="st">"input.dis"</span>, fname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"botm"</span><span class="op">)</span>, binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"botm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Lastly, the <code><a href="../reference/rmf_read_array.html">rmf_read_array()</a></code> and <code><a href="../reference/rmf_write_array.html">rmf_write_array()</a></code> functions can be used to read/write an <code>rmf_array</code> from/to separate files. These functions are not called when reading MODFLOW packages, but rather serve as utility functions when a user needs to read/write an array from/to MODFLOW supported files instead of writing an entire MODFLOW package. Because they are intended to be used outside the context of packages, they do not recognize array-control records. They can however read/write a MODFLOW output header such as:</p>
<blockquote>
<p>KSTP KPER PERTIM TOTIM DESC NCOL NROW ILAY</p>
</blockquote>
</div>
</div>
<div id="list-directed-input" class="section level2">
<h2 class="hasAnchor">
<a href="#list-directed-input" class="anchor"></a>3. List-directed input</h2>
<p>Where array-directed input represents continuous data over the MODFLOW grid, list-directed input can be thought of as discrete (spatial) features. Examples include wells, rivers, drains etc. Some output comes in list-directed form as well, most notably certain cell-by-cell fluxes from discrete boundary conditions. List-directed input basically looks like a R data.frame, containing rows and columns. Each row represent a discrete feature, the columns contain the variables. A MODFLOW list always contains the following columns: <code>i</code>, <code>j</code>, <code>k</code> representing the row, column and layer indices of the feature, respectively. Additional columns contain the variables, e.g. the well package has the <code>q</code> variable representing the volumetric flux of the well.</p>
<p>In RMODFLOW, MODFLOW lists are handled by the <code>rmf_list</code> class and corresponding S3 methods. A <code>rmf_list</code> is basically a data.frame. This might be confusing, since a list is a different class in R. We’ve chosen to follow the naming conventions in MODFLOW however.</p>
<div id="creating-1" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-1" class="anchor"></a>Creating</h3>
<p>To create a <code>rmf_list</code>, use the <code><a href="../reference/rmf_create_list.html">rmf_create_list()</a></code> function on a data.frame-like object which contains at least i, j and k columns. The passed object will be coerced to a data.frame.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wells</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">i</span>, <span class="op">~</span><span class="va">j</span>, <span class="op">~</span><span class="va">k</span>, <span class="op">~</span><span class="va">q</span>,
                <span class="fl">1</span>,   <span class="fl">1</span>,  <span class="fl">1</span>, <span class="op">-</span><span class="fl">25</span>,
                <span class="fl">2</span>,   <span class="fl">1</span>,  <span class="fl">1</span>, <span class="op">-</span><span class="fl">50</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/rmf_create_list.html">rmf_create_list</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">wells</span><span class="op">)</span>
<span class="co">#&gt; Classes 'rmf_list' and 'data.frame': 2 obs. of  4 variables:</span>
<span class="co">#&gt;  $ i: num  1 2</span>
<span class="co">#&gt;  $ j: num  1 1</span>
<span class="co">#&gt;  $ k: num  1 1</span>
<span class="co">#&gt;  $ q: num  -25 -50</span></code></pre></div>
<p>A <code>rmf_list</code> is mostly used when handling boundary condition packages. Because their input may vary per stress period, a <code>kper</code> attribute can be set on <code>rmf_list</code> as well:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="op">-</span><span class="fl">25</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">wel</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"i"</span>, <span class="st">"j"</span>, <span class="st">"k"</span>, <span class="st">"q"</span><span class="op">)</span>

<span class="fu"><a href="../reference/rmf_create_list.html">rmf_create_list</a></span><span class="op">(</span><span class="va">wel</span>, kper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Classes 'rmf_list' and 'data.frame': 1 obs. of  4 variables:</span>
<span class="co">#&gt;  $ i: num 1</span>
<span class="co">#&gt;  $ j: num 1</span>
<span class="co">#&gt;  $ k: num 2</span>
<span class="co">#&gt;  $ q: num -25</span>
<span class="co">#&gt;  - attr(*, "kper")= num [1:2] 1 4</span></code></pre></div>
<p>Time-steps are not readily handled by a <code>rmf_list</code> at the moment.</p>
</div>
<div id="reading-writing-rmf_lists" class="section level3">
<h3 class="hasAnchor">
<a href="#reading-writing-rmf_lists" class="anchor"></a>Reading &amp; writing rmf_lists</h3>
<p>The internal function <code>rmfi_parse_list</code> is used by <code>rmf_read_*</code> functions that need to read MODFLOW lists. RMODFLOW can handle reading external and open/close lists as well. There is also support for reading the rarely used SFAC value. Additionally, binary lists can also be read. There is no mention of binary lists in the MODFLOW-2005 manual, but the source code does contain functions for handling these types of lists.</p>
<p>There is no separate <code>rmfi_write_list</code> function. Writing a list consist of sequentially calling <code>rmfi_write_variables</code> on each row. There is currently no support for writing external or open/close lists. Writing of the SFAC value and of binary lists is also not available. Because of the limited use of these capabilities, these functionalities might not be added at all in RMODFLOW.</p>
</div>
</div>
<div id="conversion" class="section level2">
<h2 class="hasAnchor">
<a href="#conversion" class="anchor"></a>Conversion</h2>
<p>RMODFLOW can convert between a <code>rmf_list</code> and a <code>rmf_array</code> with the <code><a href="../reference/rmf_as_list.html">rmf_as_list()</a></code> and <code><a href="../reference/rmf_as_array.html">rmf_as_array()</a></code> functions.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmf_create_dis.html">rmf_create_dis</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nlay <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">ar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmf_create_array.html">rmf_create_array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dis</span><span class="op">$</span><span class="va">nrow</span>, <span class="va">dis</span><span class="op">$</span><span class="va">ncol</span>, <span class="va">dis</span><span class="op">$</span><span class="va">nlay</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">ar</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">ar</span><span class="op">)</span><span class="op">)</span>
<span class="va">ar</span>
<span class="co">#&gt; RMODFLOW 4d array with 3 rows, 2 columns, 1 layer and 2 timesteps, representing the i, j, k &amp; l dimensions. </span>
<span class="co">#&gt; Not representing stress period data </span>
<span class="co">#&gt; , , 1, 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    1    4</span>
<span class="co">#&gt; [2,]    2    5</span>
<span class="co">#&gt; [3,]    3    6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , 1, 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    7   10</span>
<span class="co">#&gt; [2,]    8   11</span>
<span class="co">#&gt; [3,]    9   12</span>

<span class="fu"><a href="../reference/rmf_as_list.html">rmf_as_list</a></span><span class="op">(</span><span class="va">ar</span><span class="op">[</span>,,,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; RMODFLOW list with 6 features and 1 variable </span>
<span class="co">#&gt; Not representing stress period data </span>
<span class="co">#&gt;   i j k value</span>
<span class="co">#&gt; 1 1 1 1     1</span>
<span class="co">#&gt; 2 2 1 1     2</span>
<span class="co">#&gt; 3 3 1 1     3</span>
<span class="co">#&gt; 4 1 2 1     4</span>
<span class="co">#&gt; 5 2 2 1     5</span>
<span class="co">#&gt; 6 3 2 1     6</span>

<span class="co"># a rmf_as_list.rmf_4d_array needs a l index for the 4th dimension</span>
<span class="va">lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmf_as_list.html">rmf_as_list</a></span><span class="op">(</span><span class="va">ar</span>, l <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">lst</span> 
<span class="co">#&gt; RMODFLOW list with 6 features and 1 variable </span>
<span class="co">#&gt; Not representing stress period data </span>
<span class="co">#&gt;   i j k value</span>
<span class="co">#&gt; 1 1 1 1     7</span>
<span class="co">#&gt; 2 2 1 1     8</span>
<span class="co">#&gt; 3 3 1 1     9</span>
<span class="co">#&gt; 4 1 2 1    10</span>
<span class="co">#&gt; 5 2 2 1    11</span>
<span class="co">#&gt; 6 3 2 1    12</span>

<span class="co"># rmf_as_array needs a dis object to guess the dimensions of the array</span>
<span class="fu"><a href="../reference/rmf_as_array.html">rmf_as_array</a></span><span class="op">(</span><span class="va">lst</span>, dis <span class="op">=</span> <span class="va">dis</span><span class="op">)</span>
<span class="co">#&gt; RMODFLOW 2d array with 3 rows and 2 columns, representing the i &amp; j dimensions. </span>
<span class="co">#&gt; Not representing stress period data </span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    7   10</span>
<span class="co">#&gt; [2,]    8   11</span>
<span class="co">#&gt; [3,]    9   12</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://rogiersbart.github.io/">Bart Rogiers</a>, Cas Neyens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
